# ============================================================================
# æ–‡ä»¶ï¼šæ™ºæ…§æ°´ç”µæˆæœ¬é¢„æµ‹æ•°æ®æ¨¡æ¿ç”Ÿæˆå™¨
# åŠŸèƒ½ï¼šç”ŸæˆåŒ…å«æ•°æ®è¡¨å¤´å’Œç¤ºä¾‹çš„Excelæ•°æ®æ¨¡æ¿æ–‡ä»¶
# æŠ€æœ¯ï¼špandas + openpyxl
# ============================================================================

"""
æ¨¡å—åŠŸèƒ½è¯´æ˜ï¼š
- ä¸ºæ™ºæ°´ä¿¡æ¯çš„æ°´ç”µé¡¹ç›®æˆæœ¬é¢„æµ‹æ¨¡å‹ç”Ÿæˆæ ‡å‡†æ•°æ®æ¨¡æ¿
- æä¾›æ¸…æ™°çš„æ•°æ®å­—æ®µè¯´æ˜å’Œç¤ºä¾‹æ•°æ®
- ç¡®ä¿æ•°æ®è¾“å…¥çš„æ ‡å‡†åŒ–å’Œè§„èŒƒåŒ–
"""

import pandas as pd
import os
from datetime import datetime

def create_excel_template():
    """
    åˆ›å»ºæ™ºæ…§æ°´ç”µæˆæœ¬é¢„æµ‹æ•°æ®æ¨¡æ¿Excelæ–‡ä»¶
    
    åŠŸèƒ½è¯´æ˜ï¼š
    1. åˆ›å»ºåŒ…å«æ‰€æœ‰å¿…è¦å­—æ®µçš„æ•°æ®æ¨¡æ¿
    2. æä¾›å­—æ®µè¯´æ˜å’Œæ•°æ®éªŒè¯è§„åˆ™
    3. åŒ…å«ç¤ºä¾‹æ•°æ®å¸®åŠ©ç”¨æˆ·ç†è§£æ•°æ®æ ¼å¼
    """
    
    # å®šä¹‰æ•°æ®å­—æ®µå’Œè¯´æ˜
    field_info = {
        'capacity_mw': {
            'description': 'è£…æœºå®¹é‡(MW)',
            'type': 'æ•°å€¼å‹',
            'range': '1-10000',
            'example': 500,
            'note': 'æ°´ç”µç«™çš„æ€»è£…æœºå®¹é‡ï¼Œå•ä½ä¸ºå…†ç“¦(MW)'
        },
        'project_type': {
            'description': 'é¡¹ç›®ç±»å‹',
            'type': 'åˆ†ç±»å‹',
            'range': 'å¤§å‹æ°´ç”µç«™/ä¸­å‹æ°´ç”µç«™/å°å‹æ°´ç”µç«™',
            'example': 'å¤§å‹æ°´ç”µç«™',
            'note': 'æ°´ç”µé¡¹ç›®çš„ç±»å‹åˆ†ç±»'
        },
        'location_factor': {
            'description': 'åœ°ç†ä½ç½®å› å­',
            'type': 'åˆ†ç±»å‹',
            'range': 'å±±åŒº/ä¸˜é™µ/æ²³è°·',
            'example': 'å±±åŒº',
            'note': 'é¡¹ç›®æ‰€åœ¨åœ°ç†ä½ç½®çš„å¤æ‚ç¨‹åº¦'
        },
        'construction_period': {
            'description': 'å»ºè®¾å‘¨æœŸ(æœˆ)',
            'type': 'æ•°å€¼å‹',
            'range': '12-120',
            'example': 48,
            'note': 'é¡¹ç›®ä»å¼€å·¥åˆ°å®Œå·¥çš„å»ºè®¾å‘¨æœŸï¼Œå•ä½ä¸ºæœˆ'
        },
        'economic_indicator': {
            'description': 'ç»æµæŒ‡æ ‡(GDPå¢é€Ÿ)',
            'type': 'æ•°å€¼å‹',
            'range': '0-1',
            'example': 0.075,
            'note': 'é¡¹ç›®å¼€å·¥å¹´çš„GDPå¢é€Ÿï¼Œä»¥å°æ•°å½¢å¼è¡¨ç¤º(0-1ï¼Œå¦‚0.075è¡¨ç¤º7.5%)'
        },
        'total_cost': {
            'description': 'é¡¹ç›®æ€»æŠ•èµ„(ä¸‡å…ƒ)',
            'type': 'æ•°å€¼å‹',
            'range': '1000-1000000',
            'example': 150000,
            'note': 'é¡¹ç›®çš„æ€»æŠ•èµ„é‡‘é¢ï¼Œå•ä½ä¸ºä¸‡å…ƒäººæ°‘å¸ï¼ˆç›®æ ‡å˜é‡ï¼‰'
        }
    }
    
    # åˆ›å»ºå­—æ®µè¯´æ˜è¡¨
    field_descriptions = []
    for field, info in field_info.items():
        field_descriptions.append({
            'å­—æ®µå': field,
            'ä¸­æ–‡æè¿°': info['description'],
            'æ•°æ®ç±»å‹': info['type'],
            'å–å€¼èŒƒå›´': info['range'],
            'ç¤ºä¾‹å€¼': info['example'],
            'è¯´æ˜': info['note']
        })
    
    # åˆ›å»ºç¤ºä¾‹æ•°æ®
    sample_data = [
        {
            'capacity_mw': 500.0,
            'project_type': 'å¤§å‹æ°´ç”µç«™',
            'location_factor': 'å±±åŒº',
            'construction_period': 48,
            'economic_indicator': 0.075,
            'total_cost': 150000
        },
        {
            'capacity_mw': 200.0,
            'project_type': 'ä¸­å‹æ°´ç”µç«™',
            'location_factor': 'ä¸˜é™µ',
            'construction_period': 36,
            'economic_indicator': 0.685,
            'total_cost': 80000
        },
        {
            'capacity_mw': 50.0,
            'project_type': 'å°å‹æ°´ç”µç«™',
            'location_factor': 'æ²³è°·',
            'construction_period': 24,
            'economic_indicator': 0.620,
            'total_cost': 25000
        }
    ]
    
    # åˆ›å»ºç©ºç™½æ•°æ®æ¨¡æ¿ï¼ˆç”¨æˆ·å¡«å†™åŒºåŸŸï¼‰
    empty_template = pd.DataFrame(columns=[
        'capacity_mw',
        'project_type', 
        'location_factor',
        'construction_period',
        'economic_indicator',
        'total_cost'
    ])
    
    # æ·»åŠ 10è¡Œç©ºç™½è¡Œä¾›ç”¨æˆ·å¡«å†™
    for i in range(10):
        empty_template.loc[i] = [None] * len(empty_template.columns)
    
    # ç”Ÿæˆæ–‡ä»¶å
    timestamp = datetime.now().strftime('%Y%m%d')
    filename = f'æ™ºæ…§æ°´ç”µæˆæœ¬é¢„æµ‹æ•°æ®æ¨¡æ¿_{timestamp}.xlsx'
    filepath = os.path.join('data_templates', filename)
    
    # åˆ›å»ºExcelæ–‡ä»¶
    with pd.ExcelWriter(filepath, engine='openpyxl') as writer:
        # å†™å…¥å­—æ®µè¯´æ˜
        pd.DataFrame(field_descriptions).to_excel(
            writer, 
            sheet_name='å­—æ®µè¯´æ˜', 
            index=False
        )
        
        # å†™å…¥ç¤ºä¾‹æ•°æ®
        pd.DataFrame(sample_data).to_excel(
            writer, 
            sheet_name='ç¤ºä¾‹æ•°æ®', 
            index=False
        )
        
        # å†™å…¥ç©ºç™½æ¨¡æ¿
        empty_template.to_excel(
            writer, 
            sheet_name='æ•°æ®å½•å…¥æ¨¡æ¿', 
            index=False
        )
        
        # å†™å…¥ä½¿ç”¨è¯´æ˜
        usage_instructions = pd.DataFrame([
            {'ä½¿ç”¨è¯´æ˜': '1. è¯·åœ¨"æ•°æ®å½•å…¥æ¨¡æ¿"å·¥ä½œè¡¨ä¸­å¡«å†™æ‚¨çš„é¡¹ç›®æ•°æ®'},
            {'ä½¿ç”¨è¯´æ˜': '2. å‚è€ƒ"å­—æ®µè¯´æ˜"äº†è§£æ¯ä¸ªå­—æ®µçš„å«ä¹‰å’Œè¦æ±‚'},
            {'ä½¿ç”¨è¯´æ˜': '3. å‚è€ƒ"ç¤ºä¾‹æ•°æ®"äº†è§£æ­£ç¡®çš„æ•°æ®æ ¼å¼'},
            {'ä½¿ç”¨è¯´æ˜': '4. ç¡®ä¿æ‰€æœ‰å¿…å¡«å­—æ®µéƒ½å·²å¡«å†™'},
            {'ä½¿ç”¨è¯´æ˜': '5. åˆ†ç±»å­—æ®µå¿…é¡»ä»é¢„å®šä¹‰é€‰é¡¹ä¸­é€‰æ‹©'},
            {'ä½¿ç”¨è¯´æ˜': '6. æ•°å€¼å­—æ®µè¯·ç¡®ä¿åœ¨åˆç†èŒƒå›´å†…'},
            {'ä½¿ç”¨è¯´æ˜': '7. å®Œæˆåä¿å­˜ä¸ºCSVæ ¼å¼ç”¨äºæ¨¡å‹è®­ç»ƒ'},
            {'ä½¿ç”¨è¯´æ˜': ''},
            {'ä½¿ç”¨è¯´æ˜': 'é¡¹ç›®ç±»å‹é€‰é¡¹ï¼šå¤§å‹æ°´ç”µç«™ã€ä¸­å‹æ°´ç”µç«™ã€å°å‹æ°´ç”µç«™'},
            {'ä½¿ç”¨è¯´æ˜': 'åœ°ç†ä½ç½®é€‰é¡¹ï¼šå±±åŒºã€ä¸˜é™µã€æ²³è°·'},
            {'ä½¿ç”¨è¯´æ˜': ''},
            {'ä½¿ç”¨è¯´æ˜': 'æ³¨æ„äº‹é¡¹ï¼š'},
            {'ä½¿ç”¨è¯´æ˜': '- è£…æœºå®¹é‡å•ä½ä¸ºMW'},
            {'ä½¿ç”¨è¯´æ˜': '- å»ºè®¾å‘¨æœŸå•ä½ä¸ºæœˆ'},
            {'ä½¿ç”¨è¯´æ˜': '- ç»æµæŒ‡æ ‡ä¸º0-1çš„GDPå¢é€Ÿ(å¦‚0.075è¡¨ç¤º7.5%)'},
            {'ä½¿ç”¨è¯´æ˜': '- æ€»æŠ•èµ„å•ä½ä¸ºä¸‡å…ƒäººæ°‘å¸'}
        ])
        
        usage_instructions.to_excel(
            writer, 
            sheet_name='ä½¿ç”¨è¯´æ˜', 
            index=False
        )
    
    print(f"âœ… Excelæ•°æ®æ¨¡æ¿å·²ç”Ÿæˆ: {filepath}")
    print(f"ğŸ“Š åŒ…å«å·¥ä½œè¡¨: å­—æ®µè¯´æ˜ã€ç¤ºä¾‹æ•°æ®ã€æ•°æ®å½•å…¥æ¨¡æ¿ã€ä½¿ç”¨è¯´æ˜")
    print(f"ğŸ“ è¯·åœ¨'æ•°æ®å½•å…¥æ¨¡æ¿'å·¥ä½œè¡¨ä¸­å¡«å†™æ‚¨çš„é¡¹ç›®æ•°æ®")
    
    return filepath

if __name__ == "__main__":
    # ç¡®ä¿ç›®å½•å­˜åœ¨
    os.makedirs('data_templates', exist_ok=True)
    
    # ç”ŸæˆExcelæ¨¡æ¿
    template_file = create_excel_template()
    
    print("\nğŸ¯ æ¨¡æ¿ç”Ÿæˆå®Œæˆï¼")
    print(f"ğŸ“ æ–‡ä»¶ä½ç½®: {template_file}")
    print("\nğŸ“‹ ä½¿ç”¨æ­¥éª¤:")
    print("1. æ‰“å¼€ç”Ÿæˆçš„Excelæ–‡ä»¶")
    print("2. æŸ¥çœ‹'å­—æ®µè¯´æ˜'äº†è§£æ•°æ®è¦æ±‚")
    print("3. å‚è€ƒ'ç¤ºä¾‹æ•°æ®'äº†è§£æ ¼å¼")
    print("4. åœ¨'æ•°æ®å½•å…¥æ¨¡æ¿'ä¸­å¡«å†™æ‚¨çš„æ•°æ®")
    print("5. ä¿å­˜ä¸ºCSVæ ¼å¼ç”¨äºæ¨¡å‹è®­ç»ƒ")