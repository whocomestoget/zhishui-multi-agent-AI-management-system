#!/usr/bin/env python3
"""
æç®€ç‰ˆMCPå·¥å…·åˆ¶ä½œæ¨¡æ¿
æœ€ç®€å•çš„MCPå·¥å…·å¼€å‘æ¨¡æ¿ï¼Œåªéœ€æ›¿æ¢ç¤ºä¾‹å‡½æ•°å³å¯

ä½¿ç”¨æ­¥éª¤ï¼š
1. ä¿®æ”¹å·¥å…·åç§°
2. æ›¿æ¢ my_tool å‡½æ•°ä¸ºä½ çš„åŠŸèƒ½
3. è¿è¡Œæµ‹è¯•
"""

import json
import logging
from datetime import datetime
from mcp.server.fastmcp import FastMCP

# ================================
# 1. é…ç½®ä½ çš„å·¥å…·
# ================================
TOOL_NAME = "æˆ‘çš„MCPå·¥å…·"  # ä¿®æ”¹ä¸ºä½ çš„å·¥å…·å

# è®¾ç½®æ—¥å¿—
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(TOOL_NAME)

# åˆ›å»ºMCPæœåŠ¡å™¨
mcp = FastMCP(TOOL_NAME)

# ================================
# 2. å·¥å…·å‡½æ•°ï¼ˆæ›¿æ¢è¿™é‡Œçš„å†…å®¹ï¼‰
# ================================

@mcp.tool()
def my_tool(text: str) -> str:
    """
    æˆ‘çš„å·¥å…·å‡½æ•° - æ›¿æ¢ä¸ºä½ éœ€è¦çš„åŠŸèƒ½
    
    è¿™æ˜¯ä¸€ä¸ªæ–‡æœ¬åˆ†æç¤ºä¾‹ï¼Œä½ å¯ä»¥æ›¿æ¢ä¸ºä»»ä½•åŠŸèƒ½ï¼š
    - æ–‡ä»¶æ“ä½œ
    - APIè°ƒç”¨  
    - æ•°æ®å¤„ç†
    - ç³»ç»Ÿå‘½ä»¤
    - ç­‰ç­‰...
    
    Args:
        text (str): è¾“å…¥çš„æ–‡æœ¬
        
    Returns:
        str: å¤„ç†ç»“æœ
    """
    try:
        # å‚æ•°æ£€æŸ¥
        if not text or not text.strip():
            return "âŒ é”™è¯¯ï¼šæ–‡æœ¬ä¸èƒ½ä¸ºç©º"
        
        # ä½ çš„æ ¸å¿ƒé€»è¾‘ - æ›¿æ¢ä¸‹é¢çš„ä»£ç 
        # ================================
        result = {
            "è¾“å…¥æ–‡æœ¬": text,
            "å­—ç¬¦æ•°": len(text),
            "å•è¯æ•°": len(text.split()),
            "å¤„ç†æ—¶é—´": datetime.now().strftime('%Y-%m-%d %H:%M:%S')
        }
        # ================================
        
        # è¿”å›æ ¼å¼åŒ–ç»“æœ
        return f"âœ… å¤„ç†å®Œæˆ\n\n{json.dumps(result, indent=2, ensure_ascii=False)}"
        
    except Exception as e:
        logger.error(f"å·¥å…·æ‰§è¡Œé”™è¯¯: {e}")
        return f"âŒ æ‰§è¡Œå¤±è´¥: {str(e)}"

# ================================
# 3. å¯åŠ¨æœåŠ¡å™¨
# ================================
if __name__ == "__main__":
    logger.info(f"å¯åŠ¨ {TOOL_NAME}")
    try:
        mcp.run()
    except KeyboardInterrupt:
        logger.info("æ­£åœ¨å…³é—­...")
    finally:
        logger.info("æœåŠ¡å™¨å·²å…³é—­")

# ================================
# 4. ä½¿ç”¨è¯´æ˜
# ================================
"""
ğŸš€ ä¸‰æ­¥åˆ›å»ºä½ çš„MCPå·¥å…·ï¼š

1ï¸âƒ£ ä¿®æ”¹å·¥å…·åï¼š
   TOOL_NAME = "ä½ çš„å·¥å…·å"

2ï¸âƒ£ æ›¿æ¢å·¥å…·å‡½æ•°ï¼š
   æŠŠ my_tool å‡½æ•°é‡Œçš„é€»è¾‘æ›¿æ¢ä¸ºä½ éœ€è¦çš„åŠŸèƒ½

3ï¸âƒ£ è¿è¡Œæµ‹è¯•ï¼š
   python your_tool.py

ğŸ’¡ å¸¸è§å·¥å…·ç±»å‹ï¼š
   - æ–‡ä»¶å·¥å…·ï¼šè¯»å†™æ–‡ä»¶ã€å‹ç¼©è§£å‹
   - ç½‘ç»œå·¥å…·ï¼šå‘é€è¯·æ±‚ã€ä¸‹è½½æ–‡ä»¶  
   - æ•°æ®å·¥å…·ï¼šExcelå¤„ç†ã€JSONè½¬æ¢
   - ç³»ç»Ÿå·¥å…·ï¼šæ‰§è¡Œå‘½ä»¤ã€è·å–ä¿¡æ¯
   - AIå·¥å…·ï¼šè°ƒç”¨APIã€æ–‡æœ¬å¤„ç†

ğŸ”§ å‡½æ•°æ¨¡æ¿ï¼š
   @mcp.tool()
   def å‡½æ•°å(å‚æ•°: ç±»å‹) -> str:
       try:
           # ä½ çš„é€»è¾‘
           return "âœ… æˆåŠŸç»“æœ"
       except Exception as e:
           return f"âŒ é”™è¯¯: {e}"
"""